<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <title>Compilador</title>
    <!--- bootstrap --->
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>

<body style="margin-top: 200px;">
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4">
            <h4 clas="mb-3"> Compilador </h5>
            <form>
                <div class="mb-3">
                    <label for="inputText" class="form-label">Código</label>
                <textarea type="text" class="form-control" id="inputText" aria-describedby="inputHelp"></textarea>
                <div id="inputHelp" class="form-text">Código debe apegarse a los estandares.</div>
                <div id="inputError" class="alert alert-danger" hidden role="alert">Error: </div>
            </div>
            <div class="form-check form-switch mb-3">
                <input class="form-check-input" onclick="speech()" type="checkbox" id="inputSpeech" />
                <label class="form-check-label" for="inputSpeech">Hablar</label>
            </div>
            <button type="button" onclick="compile()" class="btn btn-primary">Compilar</button>
            
            </form>
            <textarea type="text" class="mt-3 form-control" id="output" readonly></textarea>
        </div>
        <div clas="col-4"></div>
    </div>
</body>
    <script src="js/bootstrap.min.js"></script>
    <script src="compilador.js"></script>
    <script>
        
        function compile(){
            document.getElementById("output").innerText =
                parse(document.getElementById("inputText").value);
        }


        function speech(){
            window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
            const recognition = new SpeechRecognition();
            recognition.interimResults = true;
            let speechToText = "";
            recognition.addEventListener("result", e => {
                let interimTranscript = '';
                for (let i = e.resultIndex, len = e.results.length; i < len; i++) {
                    let transcript = e.results[i][0].transcript;
                    console.log(transcript)
                    if (e.results[i].isFinal) {
                    speechToText += transcript;
                    } else {
                    interimTranscript += transcript;
                    }
                }
                document.getElementById("inputText").value = speechToText.toLowerCase() + interimTranscript.toLowerCase() + ";";
            });
            recognition.onend = function() { 
                document.getElementById("inputSpeech").checked = false;
                document.getElementById("output").innerText = 
                    parse(document.getElementById("inputText").value);
                };
            recognition.lang = 'es';
            recognition.start();
        }

        function parse(inputText){
            document.getElementById("inputError").hidden = true;
            try{
                return compilador.parse(inputText);
            }catch(error){
                document.getElementById("inputError").innerText = error.message;
                document.getElementById("inputError").hidden = false;
                return "";
            }
        }

        </script>

</html>l